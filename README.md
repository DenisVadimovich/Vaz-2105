
<p align="center">
  <img src="./logo.png" alt="Описание" width="300">
</p>



<p style="text-align:center; font-weight:bolder; font-size:25px;">Дообучение модели для консультаций по ремонту ВАЗ-2105</p>

## Оглавление
- О проекте
- Архитектура модели
- Данные и обучение
- Результаты
- Использование
- Код обучения

## О проекте

Проект демонстрирует дообучение языковой модели на интересующем хобби — ремонт и обслуживание автомобилей ВАЗ-2105 (классика).

Цель: Научить модель генерировать технически корректные и полезные ответы на вопросы по ремонту Ваз-2105.

## Архитектура модели

### Базовая модель
- Модель: ai-forever/rugpt3small_based_on_gpt2
- Архитектура: GPT-2 адаптированная для русского языка
- Параметры: 125M параметров
- Контекст: 1024 токена

### Метод дообучения
- Технология: LoRA (Low-Rank Adaptation)
- Адаптеры: Добавлено всего 0.25% параметров к исходной модели (~300k параметров)
- Ранг (r): 8
- Alpha: 32
- Эффективность: Сохраняет общие языковые способности, добавляя специализацию

## Данные и обучение

### Структура датасета

### Характеристики данных
- Темы: Ремонт двигателя, замена запчастей, диагностика проблем.
- Объем: 100+ пар вопрос/ответ
- Специфика: Технические термины, детали ВАЗ-2105
- Источники: Личные знания, DeepSeek


### Примеры записей
```
{
    "prompt": "Не заводится ВАЗ-2105", "response": "1) Проверь подачу топлива - бензонасос должен работать с характерным жужжанием 2) Выкрути свечи - если мокрые от бензина, значит заливает 3) Проверь искру на свечах (выкрути свечу, прислони к массе, крути стартер) 4) Горит ли лампа CHECK? Если да - считай ошибки через диагностический разъем"
}

{
    "prompt": "Греется двигатель на холостых", "response": "1) Проверь уровень тосола в расширительном бачке (между метками min/max) 2) Почисти радиатор от грязи и пуха 3) Проверь термостат - должен открываться при 87°C, проверить можно рукой 4) Работает ли вентилятор радиатора? Должен включаться при 105°C"
}
```

## Результаты

### Тестирование на промптах автомобильной тематики
### Параметры генерации
- max_new_tokens: 100
- temperature: 0.8
- top_p: 0.92
- top_k: 40
- repetition_penalty: 1.15
- no_repeat_ngram_size: 3
- seed: 521055

#### Промпт: Почему греется двигатель ВАЗ-2105?


| Модель | Ответ | Качество |
|--------|-------|----------|
| Базовая | На нем и охлаждайка, если ты не в курсе. А так в двигателе стоит воздушный фильтр, он очень плотно к нему прилегает. А на нём радиатор с регулировкой температуры и давления. Смотря что за движок - если хендай акцент то может быть подушка охлаждения картера или форсунки для него. Если ваз 2106 то может стоять вентиля | Много лишних слов, не про ту машину речь, нет решения конкретной проблемы |
| Дообученная | свечи не горячие - может от высокого напряжения (8 В). Датчики температуры в системе охлаждения на руле и багажнике. Проверь предохранитель генератора зажигания к карбюратору. Если проблема с датчиком температуры то скорее всего неисправен термостат или реле регулятор мощности. проверьте вентиляцию радиатора печки, заслонки радиатора под кап | Уже выдает реальные решения проблемы, немного "путается" |

#### Промпт: Глохнет на ходу Ваз 2105, что делать?'


| Модель | Ответ | Качество |
|--------|-------|----------|
| Базовая | На диагностику - диагностика авто. На ремонт или замену масла и фильтра в двигателе (если машина не новая) - диагностика автомобиля. В сервисный центр. Только замена масла! Здравствуйте! Хочу узнать, какие бывают заболевания у детей дошкольного возраста? Какие болезни их можно вылечить бесплатно?! У моих деток аллергия на пыльцу. | Неинформативный, отклоняется от темы, на многих промптах пытается либо сдать ее в сервис, либо хочет купить новую машину |
| Дообученная | свечи зажигания клемы или свечи - может течь. Свечи подтекают в карбюраторе (катушка) и не заводятся до 3-х часов после запуска двигателя. Клеммы датчиков слабые? Или течь кулиса свечой (колодки) в цилиндрах? Проверь сам свечи - могут быть проблемы с проводкой к ним | Ответ относится к теме вопроса и можно понять что нужно проверять. |

#### Промпт: Что делать если машина не заводится в мороз ВАЗ-2105?


| Модель | Ответ | Качество |
|--------|-------|----------|
| Базовая | Причина может быть только одна - износа датчика кислорода. Если она стоит на месте, то скорее всего подшипник лопнул (возможно). Но это будет лишь в том случае, если ваш ВАЗ-21099 был полностью укомплектован этим агрегатом и эксплуатировался с той же регулярностью и мощностью. А вообще, если вы заметили какой-то косяк в машине | Неточный, не по теме мороза, содержит ошибки |
| Дообученная | Купи новый или замени аккумулятор на более мощный (10А). Затерьма АКБ (если есть) - нужен дополнительный аккумулятор для авто, нужно посмотреть в сервисном центре. Кран сцепления в замке зажигания (похож на поршень) может заглохнуть при торможении (особенно зимой). Проверь предохранитель замка зажигания в салоне и колодки - | Практический совет, учитывает зимние условия |

## Использование

### Тестирование моделей

Тестирование дообученной модели
```
python test_model.py --model_name ./rugpt3small_local --lora_version full --test_file test_prompts.txt --test_seed 521055
```

Тестирование базовой модели
```
python test_model.py --model_name ./rugpt3small_local --lora_version none --test_file test_prompts.txt --test_seed 521055
```

### Интерактивный чат

Запуск чата с дообученной моделью
```
python chatting.py --model_name ./rugpt3small_local --lora_version full --seed 521055
```

Запуск чата с базовой моделью
```
python chatting.py --model_name ./rugpt3small_local --lora_version none --seed 521055
```


## Код обучения

### Основные компоненты

1. Загрузка базовой модели
```
model = AutoModelForCausalLM.from_pretrained(
    ai-forever/rugpt3small_based_on_gpt2,
    torch_dtype=torch.float16,
    device_map=auto,
    trust_remote_code=True
)
```
2. Конфигурация LoRA
```
lora_config = LoraConfig(
    r=8,
    lora_alpha=32,
    target_modules=[q_proj, v_proj],
    lora_dropout=0.1,
    bias=none,
    task_type=CAUSAL_LM
)
```
3. Применение LoRA
```
model = get_peft_model(model, lora_config)
```

4. Обучение на специализированном датасете
```
trainer = Trainer(
    model=model,
    train_dataset=dataset,
    args=training_args
)
trainer.train()
```

### Этапы обучения
1. Предобработка данных: Форматирование промптов, токенизация
2. Настройка LoRA: Выбор целевых модулей, настройка ранга
3. Обучение: 10 эпох, batch size 2, learning rate 2e-4
4. Сохранение: Отдельно базовые веса и адаптеры LoRA


## Заключение

Проект успешно демонстрирует:
1. Эффективность LoRA для быстрой адаптации больших моделей
2. Специализацию ИИ на узких предметных областях
3. Практическую пользу генеративных моделей в технических сферах

Дообученная модель показывает улучшение в генерации технически корректных и полезных советов по сравнению с базовой версией.

---

Автор: Пушко Денис Вадимович